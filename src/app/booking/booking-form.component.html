<div class="container mat-elevation-z8">
<form [formGroup]="form" (ngSubmit)="onSubmit()" class="booking-form" ngClass.xs="xs">
  <h2 class="form-title" *ngIf="us.isLoggedIn | async; else unauthenticated">Réserver</h2>
  <mat-error *ngIf="form.errors" class="errors">
    <span *ngIf="(f.startTime.dirty && f.endTime.dirty) && form.errors.hoursInvalid">L'heure n'est pas valide</span>
    <span *ngIf="form.errors.dateUnavailable">Déjà réservée</span>
  </mat-error>
  <ng-template #unauthenticated>
    <div class="unauthenticated">Pour réserver, merci de vous <a routerLink="/connexion" (click)="closeDialog.emit(true)">connecter</a></div>
  </ng-template>
  <mat-form-field appearance="outline" class="startDate">
    <mat-label>Date</mat-label>
    <input matInput [matDatepicker]="startpicker" formControlName="startDate" [min]="startMin" [max]="startMax" [matDatepickerFilter]="filterDays()">
    <mat-datepicker-toggle matSuffix [for]="startpicker"></mat-datepicker-toggle>
    <mat-datepicker #startpicker [disabled]="!(us.isLoggedIn | async)"></mat-datepicker>
  </mat-form-field>
  <mat-form-field appearance="outline" class="startTime">
    <mat-label>Début</mat-label>
    <input type="time" matInput formControlName="startTime">
  </mat-form-field>
  <mat-form-field appearance="outline" class="endTime">
    <mat-label>Fin</mat-label>
    <input type="time" matInput formControlName="endTime">
  </mat-form-field>
  <mat-checkbox formControlName="weekly" class="weekly">Recurrente</mat-checkbox>
  <mat-form-field *ngIf="f.weekly && f.weekly.value" appearance="outline"  class="weekRepetition">
    <mat-label>Toutes les</mat-label>
    <mat-select formControlName="weekRepetition">
      <mat-option *ngFor="let repeat of weekRepetition" [value]="repeat">{{repeat}} semaines</mat-option>
    </mat-select>
  </mat-form-field>
  <mat-form-field *ngIf="f.weekly && f.weekly.value" appearance="outline" id="end" class="endDate">
    <mat-label>Termine le</mat-label>
    <input matInput [matDatepicker]="endpicker" formControlName="endDate" [min]="endMin" [max]="endMax" [matDatepickerFilter]="filterDays()">
    <mat-datepicker-toggle matSuffix [for]="endpicker"></mat-datepicker-toggle>
    <mat-datepicker #endpicker [startAt]="endMin" disabled="false"></mat-datepicker>
  </mat-form-field>

  <div class="price" *ngIf="duration">
    <div class="price-row">
      <div class="price-label">Tarif</div>
      <div class="price-value"><span *ngIf="duration > 1">{{duration}} x </span>{{room.price.toFixed(2)}}</div>
      <mat-icon>euros</mat-icon>
    </div>
    <div class="price-row">
      <div class="price-label">Commission ({{COMMISSION}}%)</div>
      <div class="price-value">{{commission}}</div>
      <mat-icon>euros</mat-icon>
    </div>
    <div class="price-row">
      <div class="price-label">TVA ({{TVA}}%)</div>
      <div class="price-value">{{tva}}</div>
      <mat-icon>euros</mat-icon>
    </div>
    <mat-divider></mat-divider>
    <div class="price-row">
      <div class="price-label">Total</div>
      <div class="price-value">{{total}}</div>
      <mat-icon>euros</mat-icon>
    </div>
  </div>
  <button mat-flat-button color="primary" [disabled]="invalid || !(us.isLoggedIn | async)" type="submit" class="btn-pay">
    <span class="payer">Payer</span>

  </button>

</form>
</div>
